#:import navigation_screen_manager navigation_screen_manager
#:import layouts layouts
#:import action_bar action_bar
#:import webbrowser webbrowser

# <MainMenu@BoxLayout>:
#     orientation: "vertical"
#     Label:
#         bold: True
#         text: "Kart Simulator"
#         font_size: 50
#         color: 0,1,1,1 # <-----------
#         size_hint: 1,.25
#         canvas.before:
#             Color:
#                 rgba: 0, 0, 0, 1
#             Rectangle:
#                 pos: self.pos
#                 size: self.size
#     Button:
#         text: "Sign in / Log in"
#         on_press: app.manager.push("connection"), app.ButtonSound()
#     Button:
#         text: "Play"
#         on_press: app.(), app.ButtonSound()
#     Button:
#         text: "Rules of the game"
#         on_press: app.manager.push("Rules"), app.ButtonSound()

<MainMenu2>:
    GridLayout:
        canvas.before:
            BorderImage:
                # BorderImage behaves like the CSS BorderImage
                border: 10, 10, 10, 10
                source: 'client/Images/background.jpg'
                pos: self.pos
                size: self.size
    Label:
        bold: True
        text: "Kart Simulator"
        font_size: 50
        color: 1,0,0,1 # <-----------
        pos_hint: {'x':0,'y':.85}
        size_hint: 1,.15
        canvas.before:
            Color:
                rgba: 0, 0, 0, .75
            Rectangle:
                pos: self.pos
                size: self.size
    Button:
        pos_hint: {'x':.8,'y':.8}
        size_hint: .2, .05
        # background_color: (1.0, 0.0, 0.0, .75)
        text: "Sign in / Log in"
        on_press: app.manager.push("connection"), app.ButtonSound()
    Button:
        pos_hint: {'x':.8,'y':.75}
        size_hint: .2, .05
        # background_color: (1.0, 0.0, 0.0, .75)
        text: "Create/edit a world"
        on_press: webbrowser.open("https://lj44.ch/creator/kart"), app.ButtonSound()
    Button:
        pos_hint: {'x':0,'y':.8}
        size_hint: .2, .05
        # background_color: (1.0, 0.0, 0.0, .75)
        text: "Rules of the game"
        on_press: app.manager.push("Rules"), app.ButtonSound()
    Button:
        pos_hint: {'x':0,'y':.75}
        size_hint: .2, .05
        # background_color: (1.0, 0.0, 0.0, .75)
        text: "Controls of the game"
        on_press: app.manager.push("Controls"), app.ButtonSound()

    Button:
        pos_hint: {'x':0,'y':.7}
        size_hint: .2, .05
        text: "Update the worlds"
        on_press: app.manager.push("UpdateWorlds"), app.ButtonSound()

    Button:
        pos_hint: {'x':.3,'y':.3}
        size_hint: .4, .3
        text: "Play"
        background_color: (1.0, 0.0, 0.0, .75)
        on_press: app.instanciate_ks(root.chosen_world, root.chosen_music), app.ButtonSound()

    Spinner:
        id: worlds_spinner_id
        pos_hint: {'x':0,'y':.6}
        size_hint: .2, .1
        text: "Chose your world !"
        values: root.generateWorldsList()
        on_text:
            root.changeWorldSpinnerText(worlds_spinner_id.text), app.ButtonSound(), preView_ID.changePreView(root.chosen_world)

    Spinner:
        id: music_spinner_id
        pos_hint: {'x':.8,'y':.6}
        size_hint: .2, .1
        text: "Choose your music !"
        values: root.generateMusicsList()
        on_text:
            root.changeMusicSpinnerText(music_spinner_id.text), app.ButtonSound()

    Button:
        id: prewViewButton_ID
        pos_hint: {'x':.2,'y':.6}
        size_hint: .08, .1
        text: "Preview"
        on_press: preView_ID.updatePreviewMode(), preView_ID.changePreView(root.chosen_world), app.ButtonSound()

    PreView:
        id: preView_ID
        pos_hint: {'x':0,'y':.1}
        size_hint: .2, .1
        # canvas.after:
        #     Color:
        #         rgba: 1,0,0,1
        #     Rectangle:

    Button:
        id:btnExit
        pos_hint: {'x':.95,'y':.95}
        size_hint: .05,.05
        text:"Exit"
        on_press: app.ButtonSound(), app.stop()
    
    Button:
        pos_hint: {'x':.85,'y':0}
        size_hint: .15,.05
        text:"Mute Sound"
        on_press: app.changeSoundMode(self)







<KS_screen>:
    name: "Kart_Simulator"
    layout_id: noActionBar
    # animation_id : pre_game
    # imageB: B_image
    RelativeLayout:
        id: noActionBar
        # pos: app.windowSize[0]/2,app.windowSize[1]/2
        pos: 0,0
        # canvas.before:
        #     Color:
        #         rgba: 1, 0, 0, 0.5
        #     Rectangle:
        #         pos: self.pos  # incorrect
        #         size: self.size

    GridLayout:
        cols: 2
        rows: 3
        pos_hint: {'x': .45, 'y': .9}
        size_hint: .15, .1
        canvas.before:
            Color:
                rgba: 0,0,0,1
            Rectangle:
                pos: self.pos
                size: self.size

        Label:
            text: "Laps"
            color: 0.4, 1, 0.4, 1

        Label:
            id: laps_id
            text: "0/1"
            color: 0.4, 1, 0.4, 1

        Label:
            text: "Gates"
            color: 0.4, 1, 0.4, 1

        Label:
            id: gates_id
            text: "0/2"
            color: 0.4, 1, 0.4, 1
        Label:
            text: "Timer"
            color: 0.4, 1, 0.4, 1
        Label:
            id: timer_id
            text: "00:00:00"
            color: 0.4, 1, 0.4, 1



<MyScreenManager>:
    Screen:
        name: "MainMenu"
        MainMenu2:
    Screen:
        name: "connection"
        BoxLayoutWithActionBar:
            title: "Sign in / Log in"
            MenuTabbedPanel:
    Screen:
        name: "Rules"
        BoxLayoutWithActionBar:
            title: "Rules of the game"
            Rules:
    Screen:
        name: "Controls"
        BoxLayoutWithActionBar:
            title: "Controls of the game"
            Controls:
    Screen:
        name: "UpdateWorlds"
        BoxLayoutWithActionBar:
            title: "Update the worlds"
            UpdateWorlds:    



<Rules@BoxLayout>:
    orientation: "vertical"
    Label:
        bold: True
        text: "Rules of the Kart Simulator"
        font_size: 32
        color: .8,.4,.2,1 # <-----------
        size_hint: 1,.1
        canvas.before:
            Color:
                rgba: 0, 0, 0, 1
            Rectangle:
                pos: self.pos
                size: self.size
    Label:
        italic: True
        text: ' - Le but est de compléter le nombre de tours requis le plus rapidement possible\n\n - Les karts perdent de la vitesse lorsquils touchent le bord de la piste ou des obstacles quelconques\n\n - La partie est perdue si le joueur sort de la piste (par un bout sans barrières)'
        font_size: 16
        color: 0,0,0,1 # <-----------
        size_hint: 1,.9
        canvas.before:
            Color:
                rgba: .8,.4,.2,1
            Rectangle:
                pos: self.pos
                size: self.size
  
<Controls@BoxLayout>:
    orientation: "vertical"
    Label:
        bold: True
        text: "Controls of the Kart Simulator"
        font_size: 32
        color: .8,.4,.2,1 # <-----------
        size_hint: 1,.1
        canvas.before:
            Color:
                rgba: 0, 0, 0, 1
            Rectangle:
                pos: self.pos
                size: self.size
    Label:
        italic: True
        text: ' - Avancer/Accélérer: W / up\n\n - Reculer/Ralentir: S / down\n\n - Tourner à gauche: A / left\n\n - Tourner à droite: D / right\n\n - Pause/Reprendre: Esc'
        font_size: 16
        color: 0,0,0,1 # <-----------
        size_hint: 1,.9
        canvas.before:
            Color:
                rgba: .8,.4,.2,1
            Rectangle:
                pos: self.pos
                size: self.size
  
<UpdateWorlds@BoxLayout>:
    orientation: "vertical"

    Label:
        bold: True
        text: "Update the worlds"
        font_size: 32
        color: .8,.4,.2,1 # <-----------
        size_hint: 1,.1
        canvas.before:
            Color:
                rgba: 0, 0, 0, 1
            Rectangle:
                pos: self.pos
                size: self.size

    UpdateWorldButton:
        size_hint: 1, .2
        text: "Update the worlds now"
        on_press:
            self.generateUpdatedWorldsList(updateWorlds_output_id, app.manager.get_screen("MainMenu").children[0].ids.worlds_spinner_id),
            app.ButtonSound()

    Label:
        id: updateWorlds_output_id
        text: ""
        font_size: 16
        color: 1,1,1,1 # <-----------
        size_hint: 1,.9
        canvas.before:
            Color:
                rgba: 0,0,0,1
            Rectangle:
                pos: self.pos
                size: self.size


<PauseMode>:

    Button:
        size_hint:.2,.1
        pos_hint: {'x': .4 , 'y': .5 }
        text:"Resume"
        on_release: app.game_instance.resumeGame(root.chosen_music), app.ButtonSound()
    
    Button:
        size_hint:.2,.1
        pos_hint: {'x': .4 , 'y': .4 }
        text:"Quit game"
        on_release: app.manager.pop(),app.clear_game(), app.ButtonSound()

    Spinner:
        id: music_spinner_id
        pos_hint: {'x':.8,'y':.6}
        size_hint: .2, .1
        text: root.chosen_music
        values: root.generateMusicsList()
        on_text:
            root.changeMusicSpinnerText(music_spinner_id.text), app.ButtonSound(), app.game_instance.changeMusic(root.chosen_music)


<EndGameMode>:
    canvas.before:
        Color:
            rgba: 0,0,0,.5
        Rectangle:
            pos: self.pos
            size: self.size

    Label:
        id: gameOverLabel_id
        text: ""
        font_size: 74
        halign: 'center'
        color: 0.4, 1, 0.4, 1


    Button:
        size_hint:.2,.1
        pos_hint: {'x':.4, 'y': .45}
        text:"Quit game"
        on_release: app.manager.pop(),app.clear_game(), app.ButtonSound()